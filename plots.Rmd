---
title: "R Notebook"
output:
  pdf_document: default
  html_notebook: default
---


```{r}
library(rgl)

dataFolder = "results/greyscale_analysis/"

```


```{r}
filename = "10000/flicker_analysis.csv"
#filename = "benham/flicker_analysis.csv"


df = read.csv(paste(dataFolder,filename,sep = ""), check.names = FALSE, stringsAsFactors=F)

```


```{r}

df$id <- seq.int(nrow(df))
sub = df
# select right areas (circle is not circular...)


sub = subset(sub, predicted_b>predicted_r)

sub = subset(sub, area_1>area_2)
sub = subset(sub, area_0>area_2)

sub = subset(sub, (value_t1-value_t0)>50)


plot(sub$value_t0, sub$value_t1)
plot(sub$value_t1, sub$value_t2)

plot(sub$area_0, sub$area_1)
plot(sub$area_1, sub$area_2)

plot(df$value_t0, df$value_t1)
points(sub$value_t0, sub$value_t1, col = "blue")
plot(df$value_t1, df$value_t2)
points(sub$value_t1, sub$value_t2, col = "blue")

plot(df$area_0, df$area_1)
points(sub$area_0, sub$area_1, col = "blue")
plot(df$area_1, df$area_2)
points(sub$area_1, sub$area_2, col = "blue")

plot(df$id, df$area_0)
points(sub$id, sub$area_0, col="blue")
plot(df$id, df$area_1)
points(sub$id, sub$area_1, col="blue")
plot(df$id, df$area_1)
points(sub$id, sub$area_1, col="blue")

plot(df$id, df$value_t0)
points(sub$id, sub$value_t0, col="blue")
plot(df$id, df$value_t1)
points(sub$id, sub$value_t1, col="blue")
plot(df$id, df$value_t2)
points(sub$id, sub$value_t2, col="blue")


plot(sub$area_0)
plot(sub$area_1)
plot(sub$area_2)
plot(sub$value_t0)
plot(sub$value_t1)
plot(sub$value_t2)

v0 = mean(sub$value_t0)
v1 = mean(sub$value_t1)
v2 = mean(sub$value_t2)

vec = c(v0, v1, v2)
plot(vec, type = "l", col = colors[c_index+1]
   , main = "values", ylim = c(min(vec)-10, max(vec)+10)
   )

a0 = mean(sub$area_0)
a1 = mean(sub$area_1)
a2 = mean(sub$area_2)

plot(c(a0, a1, a2), type = "l", col = colors[c_index+1], main = "areas")

plot(sub$predicted_b, type="l", col="blue", ylim = c(0,255))
#points(sub$predicted_g, type="l", col="green")
points(sub$predicted_r, type="l", col="red")

print(mean(sub$predicted_b))
print(mean(sub$predicted_r))
print(mean(sub$predicted_g))

# black white black
# medium medium-small small
# lines, white +bg , black part
  
```


```{r}
# filename = "benham/area_analysis.csv"
# filename = "0/area_analysis.csv"
filename = "10000/area_analysis.csv"

df = read.csv(paste(dataFolder,filename,sep = ""), check.names = FALSE)


c_index=0
```


```{r}
plot_areas = function(c_index, df){
  colors = c("red", "green", "blue")

  sub = subset(df, color_index == c_index)

  # sub = subset(sub, value_t0 != 0)
  # sub = subset(sub, color_value > 200)
  plot(sub$value_t1, sub$value_t2)
  points(c(0,50000), c(0,50000), type = "l", col= "red")
  plot(sub$area_1, sub$area_2)
  points(c(0,50000), c(0,50000), type = "l", col= "red")


  v0 = mean(sub$value_t0)
  v1 = mean(sub$value_t1)
  v2 = mean(sub$value_t2)
  
  vec = c(v0, v1, v2)
  plot(vec, type = "l", col = colors[c_index+1]
       , main = "values", ylim = c(min(vec)-10, max(vec)+10)
       )
  
  a0 = mean(sub$area_0)
  a1 = mean(sub$area_1)
  a2 = mean(sub$area_2)
  
  plot(c(a0, a1, a2), type = "l", col = colors[c_index+1], main = "areas")
}
```


```{r}

#red
plot_areas(0, df)
plot_areas(2, df)
plot_areas(1, df)


df_no_label = df
df_no_label$color_index <- NULL

pr <- prcomp(df_no_label, center = TRUE, scale = TRUE)
summary(pr)


plot(pr$x[,1],pr$x[,2], col=df$color_index+1)
plot(pr$x[,2],pr$x[,3], col=df$color_index+1)

plot3d(pr$x[,1],pr$x[,2],pr$x[,3], col=df$color_index+1)

plot_areas(0, sub)
plot_areas(2, sub)
plot_areas(1, sub)
# 
#sub = subset(df, color_index == 2)
#plot(sub$color_value)

sub = subset(df, area_2<20)
sub = subset(sub, value_t0<20)
length(subset(sub, color_index==0)$color_index)
length(subset(sub, color_index==1)$color_index)
length(subset(sub, color_index==2)$color_index)

sub = subset(df, value_t2>205 & value_t1<100)
length(subset(sub, color_index==0)$color_index)
length(subset(sub, color_index==1)$color_index)
length(subset(sub, color_index==2)$color_index)


```



```{r}
dataFolder = "image_analysis/"

# install.packages("RColorBrewer")
library(RColorBrewer)
```

Plot color and surrounding colors

```{r}

filename = "black_white_next/bike_15m_flicker_surround.csv"
df = read.csv(paste(dataFolder,filename,sep = ""), check.names = FALSE)

plot(df$bw_r, col = "red", type = "l",
     main = "bw, surround", ylim = c(0,255)
     #,ylab = "Mean value"
    )
points(df$bw_b, col = "blue", type = "l")

plot(df$wb_r, col = "red", type = "l",
     main = "wb, surround", ylim = c(0,255)
     #,ylab = "Mean value"
    )
points(df$wb_b, col = "blue", type = "l")

print(mean(df$bw_r))
print(mean(df$bw_b))
print(mean(df$wb_r))
print(mean(df$wb_b))

```


Plot colors during and after flicker

```{r}

filename = "black_white_next/bike_15m_flicker_before.csv"
df = read.csv(paste(dataFolder,filename,sep = ""), check.names = FALSE)

colors = brewer.pal(n = 3, name = "YlOrRd")
plot(df$bw_r0, col = colors[1], type = "l",
     main = "Colored flickers: black, white, ...", ylim = c(0,255)
    )
points(df$bw_r1, col = colors[2], type = "l")
points(df$bw_r2, col = colors[3], type = "l")

plot(df$wb_r0, col = colors[1], type = "l",
     main = "Colored flickers: white, black, ...", ylim = c(0,255)
    )
points(df$wb_r1, col = colors[2], type = "l")
points(df$wb_r2, col = colors[3], type = "l")

evo_r = c(mean(df$bw_r0), mean(df$bw_r1), mean(df$bw_r2))
evo_g = c(mean(df$bw_g0), mean(df$bw_g1), mean(df$bw_g2))
evo_b = c(mean(df$bw_b0), mean(df$bw_b1), mean(df$bw_b2))
plot(evo_r, col = "red", type = "l",
     main = "Mean rgb value of black->white flickering pixels", ylim = c(0,255),
     ylab = "Mean value", xlab = "t0 = black, t1 = white, t2 = next color"
    )
points(evo_g, col = "green", type = "l")
points(evo_b, col = "blue", type = "l")

evo_r = c(mean(df$wb_r0), mean(df$wb_r1), mean(df$wb_r2))
evo_g = c(mean(df$wb_g0), mean(df$wb_g1), mean(df$wb_g2))
evo_b = c(mean(df$wb_b0), mean(df$wb_b1), mean(df$wb_b2))
plot(evo_r, col = "red", type = "l",
     main = "Mean rgb value of white->black flickering pixels", ylim = c(0,255),
     ylab = "Mean value", xlab = "t0 = white, t1 = black, t2 = next color"
    )
points(evo_g, col = "green", type = "l")
points(evo_b, col = "blue", type = "l")

```

```{r}
plot(df$bw_r0, col = "red", type = "l",
     main = "bw t0,  ...", ylim = c(0,255)
    )
points(df$bw_g0, col = "green", type = "l")
points(df$bw_b0, col = "blue", type = "l")

plot(df$bw_r1, col = "red", type = "l",
     main = "bw t1, ...", ylim = c(0,255)
    )
points(df$bw_g1, col = "green", type = "l")
points(df$bw_b1, col = "blue", type = "l")

plot(df$bw_r2, col = "red", type = "l",
     main = "Colored flickers: black, white, ...", ylim = c(0,255)
    )
points(df$bw_g2, col = "green", type = "l")
points(df$bw_b2, col = "blue", type = "l")


plot(df$wb_r0, col = "red", type = "l",
     main = "wb t0,  ...", ylim = c(0,255)
    )
points(df$wb_g0, col = "green", type = "l")
points(df$wb_b0, col = "blue", type = "l")

plot(df$wb_r1, col = "red", type = "l",
     main = "Colored flickers: white, black, ...", ylim = c(0,255)
    )
points(df$wb_g1, col = "green", type = "l")
points(df$wb_b1, col = "blue", type = "l")

plot(df$wb_r2, col = "red", type = "l",
     main = "Colored flickers: white, black, ...", ylim = c(0,255)
    )
points(df$wb_g2, col = "green", type = "l")
points(df$wb_b2, col = "blue", type = "l")
```


Comparing the flickers

```{r}
filename = "black_white_next/bike_15m_shift.csv"
df = read.csv(paste(dataFolder,filename,sep = ""), check.names = FALSE)

ymax = max(c(df$bw_r,df$bw_b))
plot(df$bw_r, col = "red", type = "l",
     main = "Colored flickers: black, white, ..."#, ylim = c(1,4)
    )
points(df$bw_b, col="blue", type="l")

# legend(15, max(df$red_top), legend=c("Sum of red", "Sum of blue"),
#       col=c("red", "blue"), cex=0.8)

ymax = max(c(df$bw_r,df$bw_b))
plot(df$wb_r, col = "red", type = "l",
     main = "Colored flickers: white, black, ..."#, ylim = c(1,4)
    )
points(df$wb_b, col="blue", type="l")

print("bw")
print(mean(df$bw_b))
print(mean(df$bw_r))
print("wb")
print(mean(df$wb_b))
print(mean(df$wb_r))

```

Looking at sequences

```{r}
filename = "black_white_next/fpsi_transitions.csv"
df = read.csv(paste(dataFolder,filename,sep = ""), check.names = FALSE, stringsAsFactors= FALSE)

combi_w = unique(df$white_tr)
combi_b = unique(df$black_tr)
print(combi_w)
print(combi_b)

print("white")
for(combi in combi_w){
  a = subset(df, white_tr == combi)
  print(combi)
  print(length(a$white_tr))
}

print("\n black")
for(combi in combi_b){
  a = subset(df, black_tr == combi)
  print(combi)
  print(length(a$black_tr))
}

a = subset(df, black_tr == "0_0_1_1")
print(unique(a$white_tr))

```


Look at the average color of the sky

```{r}
filename = "black_white_next/bike_15m_left_sample.csv"
df = read.csv(paste(dataFolder,filename,sep = ""), check.names = FALSE)

plot(df$r, col = "red", type = "l",
     main = "left corner rgb", ylim = c(0,255)
    )
points(df$b, col="blue", type="l")

points(df$g, col="green", type="l")
```



Comparing the amount of blue in the top of the images (==background: sky, trees) vs the bottom (foreground: road).
Hypothesis: maybe backgrounds tend to be redder and foregrounds tend to be bluer?

```{r}
filename = "top_bottom_diff.csv"
df = read.csv(paste(dataFolder,filename,sep = ""), check.names = FALSE)

```

```{r}
plot(df$red_top, col = "red", type = "l",
     main = "Top of frames", ylim = c(min(df$blue_top)-100000, max(df$red_top) + 100000)
    )
points(df$blue_top, col="blue", type="l")
legend(15, max(df$red_top), legend=c("Sum of red", "Sum of blue"),
       col=c("red", "blue"), cex=0.8)

plot(df$red_bottom, col = "red", type = "l",
     main = "Bottom of frames", ylim = c(min(df$blue_bottom)-100000, max(df$red_bottom) + 100000)
    )
points(df$blue_bottom, col="blue", type="l")
legend(15, max(df$red_top), legend=c("Sum of red", "Sum of blue"),
       col=c("red", "blue"), cex=0.8)


plot(df$red_top, col = "red", type = "l", 
     main = "Red in frames, bottom vs top", ylim = c(min(df$red_top)-100000, max(df$red_bottom) + 100000)
    )
points(df$red_bottom, col="red", type="l", lty=2)
legend(15, max(df$red_top), legend=c("Red in top", "Red in bottom"),
       col=c("red", "red"), lty=1:2, cex=0.8)

plot(df$blue_top, col = "blue", type = "l", 
     main = "Blue in frames, bottom vs top", ylim = c(min(df$blue_bottom)-100000, max(df$blue_bottom) + 100000)
    )
points(df$blue_bottom, col="blue", type="l", lty=2)
legend(15, max(df$blue_top), legend=c("Blue in top", "Blue in bottom"),
       col=c("blue", "blue"), lty=1:2, cex=0.8)
```


Test if approaching objects become bluer/redder as result of atmospheric dispersion

```{r}
filename = "reds_blues.csv"
df = read.csv(paste(dataFolder,filename,sep = ""), check.names = FALSE)

```

```{r}

plot(df$red, col = "red", type = "l",
     main = "Approaching tree", ylim = c(min(df$red)-2, max(df$blue) + 2)
    )
points(df$blue, col="blue", type="l")
legend(8, 58, legend=c("Red average", "Blue average"),
       col=c("red", "blue"),  lty=c(1,1), cex=0.8)
```

Check if moving objects have more blues on their motion direction side and more red on the other side

```{r}
filename = "motion_half.csv"
df = read.csv(paste(dataFolder,filename,sep = ""), check.names = FALSE)

```

```{r}
plot(df$red_left, col = "red", type = "l",
     main = "Left of frames"#, ylim = c(min(df$blue_top)-100000, max(df$red_top) + 100000)
    )
points(df$blue_left, col="blue", type="l")
legend(8, 32, legend=c("Red Average", "Blue average"),
       col=c("red", "blue"), lty=c(1,1), cex=0.8)

plot(df$red_right, col = "red", type = "l",
     main = "Right of frames", ylim = c(min(df$red_right)-2, max(df$blue_right) + 2)
    )
points(df$blue_right, col="blue", type="l")
legend(8, 30, legend=c("Red Average", "Blue average"),
       col=c("red", "blue"), lty=c(1,1), cex=0.8)

```


Colors

```{r}
dataFolder = "results//bike_lines_fw//"
filename = "colors_average_20.csv"
df = read.csv(paste(dataFolder,filename,sep = ""), check.names = FALSE)

plot(x = df$red, type = "l", col = "red", ylab = "Average color values"
     #, ylim=c(0,10)
     )
points(x = df$green, type = "l", col = "green")
points(x = df$blue, type = "l", col = "blue")
```


Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.
